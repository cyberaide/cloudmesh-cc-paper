\section{Cloudmask Workflow}\label{cloudmask-workflow}

Cloudmesh cc comes with an example workflow that runs Cloudmask, which
is a program that develops a model to classify sections of satellite
images. Information regarding Cloudmask can be found at
\url{https://github.com/laszewsk/mlcommons/tree/main/benchmarks/cloudmask\#readme}

\subsection{Running the Cloudmask Workflow on
Rivanna}\label{running-the-cloudmask-workflow-on-rivanna}

To execute the workflow on UVA's HPC supercomputer, Rivanna, first
ensure that your UVA Computing ID is set with the following command,
replacing the X's with your ID:

\begin{minted}[breaklines]{bash}
me@mycomputer $ cms set username=XXXXXX
\end{minted}

Then, connect to the UVA Anywhere VPN and then download the satellite
data into your
\href{https://www.rc.virginia.edu/userinfo/storage/non-sensitive-data/\#scratch}{scratch}
directory on Rivanna:

\bigbreak
\begin{minted}[breaklines]{bash}
me@mycomputer $ cms vpn connect
me@mycomputer $ ssh rivanna
rivanna $ cd /scratch/$USER
rivanna $ git clone https://github.com/laszewsk/mlcommons.git
rivanna $ cd mlcommons/benchmarks/cloudmask/target/rivanna
rivanna $ make data
# downloading the data will take a while.
rivanna $ exit
\end{minted}
\bigbreak

Next, clone the \texttt{mlcommons} repository on your local machine and
run the workflow:

\bigbreak
\begin{minted}[breaklines]{bash}
me@mycomputer $ cd ~/cm
me@mycomputer $ git clone https://github.com/laszewsk/mlcommons.git
me@mycomputer $ cd mlcommons
me@mycomputer $ pytest -v -x --capture=no benchmarks/cloudmask/target/rivanna/run_cloudmask_workflow.py
\end{minted}
\bigbreak

The workflow iterates through the five GPUs available on Rivanna---
A100, V100, P100, RTX2080, and K80--- and runs the program three times
on each GPU. Each run trains the model with 10, 30, and 50 epochs for
benchmarking.

Upon completing a run, the logs and benchmarks of the program can be
found in the target folder:

\bigbreak
\begin{minted}[breaklines]{bash}
me@mycomputer $ ssh rivanna
rivanna $ cd /scratch/$USER/mlcommons/benchmarks/cloudmask/target
\end{minted}
\bigbreak

Additionally, the generated \texttt{.h5} model file can be found in the
home directory:

\bigbreak
\begin{minted}[breaklines]{bash}
rivanna $ cd ~/sciml_bench/outputs/slstr_cloud/
\end{minted}
\bigbreak

The program may take a while to run if the resources on Rivanna are
being used by other jobs.
