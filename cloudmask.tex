\FILE{Cloudmask.tex}

\section{Cloudmask Workflow}\label{cloudmask-workflow}

Cloudmask is a program that develops a model to classify sections
of satellite images as either containing clouds or clear sky by
using machine learning. This is beneficial for temperature measurement and
meteorology.
Information regarding Cloudmask can be found on its GitHub page \cite{www-cloudmask}.
As running Cloudmask requires several phases and scripts, including a
mixture of shell scripts and Python scripts, leveraging Cloudmesh-cc
provides a much easier runtime instead of manually issuing many commands at
a terminal.

\subsection{Running the Cloudmask Workflow on
Rivanna}\label{running-the-cloudmask-workflow-on-rivanna}

To execute the Cloudmask workflow on UVA's HPC supercomputer, Rivanna, first
ensure that your UVA Computing ID is set with the following command,
replacing the X's with your ID:

\begin{minted}[breaklines]{bash}
me@mycomputer $ cms set username=XXXXXX
\end{minted}

Then, connect to the UVA Anywhere VPN and then download the satellite
data into your
\href{https://www.rc.virginia.edu/userinfo/storage/non-sensitive-data/\#scratch}{scratch}
directory on Rivanna \cite{www-rivanna}:

\smallskip
\begin{minted}[breaklines]{bash}
me@mycomputer $ cms vpn connect
me@mycomputer $ ssh rivanna
rivanna $ cd /scratch/$USER
rivanna $ git clone https://github.com/laszewsk/mlcommons.git
rivanna $ cd mlcommons/benchmarks/cloudmask/target/rivanna
rivanna $ make data
# downloading the data will take a while.
rivanna $ exit
\end{minted}
\smallskip

Next, clone the {\scriptsize \verb|mlcommons|} repository on your local machine and
run the workflow:

\smallskip
\begin{minted}[breaklines]{bash}
me@mycomputer $ cd ~/cm
me@mycomputer $ git clone https://github.com/laszewsk/mlcommons.git
me@mycomputer $ cd mlcommons
me@mycomputer $ pytest -v -x --capture=no benchmarks/cloudmask/target/rivanna/run_cloudmask_workflow.py
\end{minted}
\smallskip

The workflow will likely take around 24 hours to run. The workflow iterates through the five GPUs available on Rivanna---
A100, V100, P100, RTX2080, and K80--- and runs the program three times
on each GPU. Each run trains the model with 10, 30, and 50 epochs for
benchmarking.

Upon completing a run, the logs and benchmarks of the program can be
found in the target folder:

\smallskip
\begin{minted}[breaklines]{bash}
me@mycomputer $ ssh rivanna
rivanna $ cd /scratch/$USER/mlcommons/benchmarks/cloudmask/target
\end{minted}
\smallskip

Additionally, the generated \texttt{.h5} model file can be found in the
home directory:

\smallskip
\begin{minted}[breaklines]{bash}
rivanna $ cd ~/sciml_bench/outputs/slstr_cloud/
\end{minted}
\smallskip

The program may take a while to run if the resources on Rivanna are
being used by other jobs.
